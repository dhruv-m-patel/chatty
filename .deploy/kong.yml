_format_version: '2.1'
_transform: true

services:
  # Auth Service
  - name: authServiceV1.Api.Service
    url: http://auth-service:8010/api/
    routes:
      - name: authServiceV1.Api.Route
        paths: [/auth/api/]
  - name: authServiceV1.Contract.Service
    url: http://auth-service:8010/docs/
    routes:
      - name: authServiceV1.Contract.Route
        paths: ['/auth/docs/']
  - name: authServiceV1.Health.Service
    url: http://auth-service:8010/api/health
    routes:
      - name: authServiceV1.Health.Route
        paths: ['/auth/api/health']

  # High Five Service
  - name: highFiveServiceV1.Health.Service
    url: http://high-five-service:8011/api/health
    routes:
      - name: highFiveServiceV1.Health.Route
        paths: ['/high-fives/api/health']
  - name: highFiveServiceV1.Contract.Service
    url: http://high-five-service:8011/docs/
    routes:
      - name: highFiveServiceV1.Contract.Route
        paths: ['/high-fives/docs/']
  - name: highFiveServiceV1.Api.Service
    url: http://high-five-service:8011/api/
    routes:
      - name: highFiveServiceV1.Api.Route
        paths: [/high-fives/api/]
    plugins:
      - name: oidc
        config: &oidc-config
          client_id: hestia
          client_secret: 4b6dd29e-aa45-4c7f-ba79-95a2c19379ea
          bearer_only: 'yes'
          realm: wfdev
          introspection_endpoint: https://authn.alcdev.net/auth/realms/wfdev/protocol/openid-connect/token/introspect
          discovery: https://authn.alcdev.net/auth/realms/wfdev/.well-known/openid-configuration

  # Users Service
  - name: usersServiceV1.Health.Service
    url: http://users-service:8012/api/health
    routes:
      - name: usersServiceV1.Health.Route
        paths: ['/users/api/health']
  - name: usersServiceV1.Contract.Service
    url: http://users-service:8012/docs/
    routes:
      - name: usersServiceV1.Contract.Route
        paths: ['/users/docs/']
  - name: usersServiceV1.Api.Service
    url: http://users-service:8012/api/
    routes:
      - name: usersServiceV1.Api.Route
        paths: [/users/api/]
    plugins:
      - name: oidc
        config: *oidc-config

  # Proxy Service
  - name: proxyServiceV1.Health.Service
    url: http://proxy-service:8015/api/health
    routes:
      - name: proxyServiceV1.Health.Route
        paths: ['/proxy/api/health']
  - name: proxyServiceV1.Contract.Service
    url: http://proxy-service:8015/docs/
    routes:
      - name: proxyServiceV1.Contract.Route
        paths: ['/proxy/docs/']
  - name: proxyServiceV1.Api.Service
    url: http://proxy-service:8015/api/
    routes:
      - name: proxyServiceV1.Api.Route
        paths: [/proxy/api/]
    plugins:
      - name: oidc
        config: *oidc-config

  # Entity History Service
  - name: entityHistoryServiceV1.Health.Service
    url: http://entity-history-service:8040/api/health
    routes:
      - name: entityHistoryServiceV1.Health.Route
        paths: ['/entity-history/api/health']
  - name: entityHistoryServiceV1.Contract.Service
    url: http://entity-history-service:8040/docs/
    routes:
      - name: entityHistoryServiceV1.Contract.Route
        paths: ['/entity-history-service/docs/']
  - name: entityHistoryServiceV1.Api.Service
    url: http://entity-history-service:8040/api/
    routes:
      - name: entityHistoryServiceV1.Api.Route
        paths: [/entity-history/api/]
    plugins:
      - name: oidc
        config: *oidc-config

  # Safety Intelligence Service
  - name: safetyIntelligenceServiceV1.Health.Service
    url: http://safety-intelligence-service:8014/api/health
    routes:
      - name: safetyIntelligenceServiceV1.Health.Route
        paths: ['/safety-intelligence/api/health']
  - name: safetyIntelligenceServiceV1.Contract.Service
    url: http://safety-intelligence-service:8014/docs/
    routes:
      - name: safetyIntelligenceServiceV1.Contract.Route
        paths: ['/safety-intelligence-service/docs/']
  - name: safetyIntelligenceServiceV1.Api.Service
    url: http://safety-intelligence-service:8014/api/
    routes:
      - name: safetyIntelligenceServiceV1.Api.Route
        paths: [/safety-intelligence/api/]
    plugins:
      - name: oidc
        config: *oidc-config
consumers:
  - username: wildbreeze-wfdev

plugins:
  - name: cors
    config:
      origins: ['*']
      methods: [POST, PUT, GET, HEAD, OPTIONS, DELETE]
      headers: ['*']
      credentials: false
      max_age: 1
      preflight_continue: false
