import { getMessageBroker, MessageBroker } from '../index';

const url = 'amqp://localhost';
const exch = 'test_exchange3';
const rkey1 = 'HighFive Created';
const rkey2 = 'HighFive Updated';
const rkey3 = 'HighFive Deleted';
const msg1 = { docName: 'High Five 1', operation: 123, TTL: 'forever' };
const msg2 = { docName: 'High Five 2', operation: 123, owner: 'Ammar' };
const msg3 = { docName: 'High Five 3', operation: 123 };
/**
 * This function creates a message broker object and sends 3 messages with different routing keys (topics)
 * @param args
 */

async function produce(args: any) {
  const { url, exch } = args;
  const messageBroker: MessageBroker = await getMessageBroker(url);
  await messageBroker.createExchange(exch);
  await messageBroker.publishMessage(rkey1, msg1);
  await messageBroker.publishMessage(rkey2, msg2);
  await messageBroker.publishMessage(rkey3, msg3);
  setTimeout(function () {
    messageBroker.close();
  }, 500);
}
produce({ url, exch });
